<div class="max">
  <div class="controls">
    <button (click)="toggleReadOnlyMode()" [class.active]="readOnlyMode()">
      {{ readOnlyMode() ? 'Exit Read-Only' : 'Read-Only Mode' }}
    </button>
    <button (click)="resetCamera()">Reset</button>
    <button (click)="toggleCreateMode()" [class.active]="isCreateMode()">
      {{ isCreateMode() ? 'Exit Create' : 'Create Mode' }}
    </button>
    <button (click)="toggleBoxList()" [class.active]="showBoxList()">
      {{ showBoxList() ? 'Hide Boxes' : 'Show Boxes' }}
    </button>
    <button (click)="toggleMagicMode()" [class.active]="isMagicMode()">
      {{ isMagicMode() ? 'Exit Magic' : 'Magic Box' }}
    </button>
    @if (isMagicMode()) {
      <label>
        Tolerance:
        <input
          type="number"
          [(ngModel)]="magicTolerance"
          min="5"
          max="100"
          step="5"
          class="tolerance-input"
        />
      </label>
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="debugMagic" />
        Debug Logs
      </label>
    }
    <button (click)="toggleMeasurementMode()" [class.active]="isMeasurementMode()">
      {{ isMeasurementMode() ? 'Exit Measurement' : 'Measurement Tool' }}
    </button>
    @if (isMeasurementMode()) {
      <label>
        Width (m):
        <input
          type="number"
          [(ngModel)]="metricWidth"
          min="0.1"
          step="0.1"
          class="tolerance-input"
        />
      </label>
      <label>
        Height (m):
        <input
          type="number"
          [(ngModel)]="metricHeight"
          min="0.1"
          step="0.1"
          class="tolerance-input"
        />
      </label>
    }
    <label>Zoom: {{ zoom() }}%</label>
  </div>

  <div class="main-content">
    <app-canvas-viewport
      [backgroundUrl]="'/assets/background.jpg'"
      [isCreateModeInput]="isCreateMode()"
      [isMagicModeInput]="isMagicMode()"
      [isMeasurementModeInput]="isMeasurementMode()"
      [magicToleranceInput]="magicTolerance()"
      [metricWidthInput]="metricWidth()"
      [metricHeightInput]="metricHeight()"
      [debugMagicInput]="debugMagic()"
      [readOnlyMode]="readOnlyMode()"
      [externalHoverBoxId]="hoveredBoxId()"
      [externalSelectBoxId]="selectedBoxId()"
      (zoomChange)="onZoomChange($event)"
      (createModeChange)="onCreateModeChange($event)"
      (magicModeChange)="onMagicModeChange($event)"
      (measurementModeChange)="onMeasurementModeChange($event)"
      (selectedBoxChange)="onSelectedBoxChange($event)"
      (hoveredBoxChange)="onHoveredBoxChange($event)"
    ></app-canvas-viewport>

    @if (showBoxList()) {
      <app-box-list
        [boxes]="historyService.visibleBoxes()"
        [selectedBoxId]="selectedBoxId()"
        [hoveredBoxId]="hoveredBoxId()"
        (boxHover)="onBoxListHover($event)"
        (boxClick)="onBoxListClick($event)"
      ></app-box-list>
    }
  </div>
</div>
